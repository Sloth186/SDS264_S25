---
title: "R Tip of the Day"
subtitle: "Timevis"
author: "Shen Rothermel"
date: "March 20, 2025"
format:
  revealjs: 
    slide-number: true
    chalkboard: 
      buttons: true
    preview-links: auto
editor_options: 
  chunk_output_type: console
---

```{r Libraries}
library(nycflights13)
library(stringr)
library(tidyverse)
library(timevis)
```

## Timevis

::: {.fragment .fade-in}
Package for making timelines
:::

::: {.fragment .fade-in}
```{r}
#| echo: true
timevis()
```
:::

## Dataset

::: {.fragment .fade-in}
We will use the `flight`s dataset for our examples
:::

::: {.fragment .fade-in}
```{r}
head(flights)
```
:::

::: {.fragment .fade-in}
Each row contains information about a single flight, including the date it occurred, departure and arrival time, origin and destination, identifying information about the plane, etc.
:::

## Supplying a Data Frame

::: {.fragment .fade-in}
`timevis()` takes a `data frame`, which is a base R object type.
:::

::: {.fragment .fade-in}
This data frame must at a minimum have a `content` and a `start` variable. The former determines what text to put in the box, and the latter determines where along the timeline to put the box.
:::

::: {.fragment .fade-in}
With our `flights` dataset, we can do our usual tidyverse magic, then use the `as.data.frame()` function to easily convert it into a data frame.
:::

## Building the Data Frame

```{.r code-line-numbers="0|1-4|6-7|8|9-10|11-12|0"}
timevis_date <- function(year, month, day, time) {
	paste(year, "-", month, "-", day, " ",
	str_sub(time, 1, -3), ":", str_sub(time, -2, -1), sep = "")
}

sample_flights <- flights |>
	filter(!is.na(dep_time), !is.na(arr_time)) |> 
	slice_sample(n = 5) |>
	mutate(content = paste(origin, " to ", dest, sep = ""),
				 start = timevis_date(year, month, day, dep_time)) |>
	select(content, start) |>
	as.data.frame()
sample_flights
```

::: {.fragment .fade-in}
```{r}
timevis_date <- function(year, month, day, time) {
	paste(year, "-", month, "-", day, " ",
				str_sub(time, 1, -3), ":", str_sub(time, -2, -1), sep = "")
}

sample_flights <- flights |>
	filter(!is.na(dep_time), !is.na(arr_time)) |> 
	slice_sample(n = 5) |>
	mutate(content = paste(origin, " to ", dest, sep = ""),
				 start = timevis_date(year, month, day, dep_time)) |>
	select(content, start) |>
	as.data.frame()
sample_flights
```
:::

## Visualize

```r
timevis(sample_flights)
```

```{r}
timevis(sample_flights, height = 300)
arrange(sample_flights, date(start))
```

## Point Events

```{r}
#| echo: true
sample_flights <- sample_flights |> 
	mutate(type = "point")
sample_flights
timevis(sample_flights)
```

## Ranged Event

```{r}
ranged_flight <- flights |> 
	slice_max(air_time) |> 
	mutate(content = paste(origin, " to ", dest, " | Departure: ", dep_time, " | Arrived: ", arr_time),
				 start = timevis_date(year, month, day, dep_time),
				 end = timevis_date(year, month, day, arr_time)) |> 
	select(content, start, end) |> 
	as.data.frame()
ranged_flight
timevis(ranged_flight)
```

